@model Rental.ViewModels.ResetPasswordViewModel

<style>
    nav {
        display: none !important;
    }

    body {
        background-color: #f0f4ff;
    }

    .card-wrapper {
        margin-top: 140px;
    }
</style>

<!-- Notification (hidden initially) -->
<div id="resetAlert"
     class="alert text-center"
     style="display:none; position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:1050; width:320px;">
    <!-- text set from JS -->
</div>

<!-- CENTER THE CARD -->
<div class="d-flex justify-content-center card-wrapper">
    <div class="card text-center" style="width: 400px; background-color: white;">

        <div class="card-header h5 text-white bg-success">Reset Password</div>

        <div class="card-body px-5">
            <p class="card-text text-Black py-2">
                Enter your email and a new password to reset your account.
            </p>

            <form id="resetForm" asp-action="ResetPassword" method="post">
                @* token from the email link *@
                <input type="hidden" asp-for="Token" />

                <div class="my-3 text-start">
                    <label asp-for="Email" class="form-label"></label>
                    <input asp-for="Email" class="form-control" />
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>

                <div class="my-3 text-start">
                    <label asp-for="Password" class="form-label"></label>
                    <input asp-for="Password" class="form-control" type="password" />
                    <span asp-validation-for="Password" class="text-danger"></span>
                </div>

                <!-- Button triggers notification + redirect -->
                <button type="button" id="resetBtn" class="btn btn-success w-100">
                    Reset Password
                </button>
            </form>

            @* Login/Register links removed *@

        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // login URL from ASP.NET routing
        var loginUrl = '@Url.Action("Login", "Account")';

        document.getElementById('resetBtn').addEventListener('click', function () {

            var emailInput = document.querySelector('[name="Email"]').value.trim();
            var passwordInput = document.querySelector('[name="Password"]').value.trim();
            var alertBox = document.getElementById('resetAlert');

            // basic validation
            if (emailInput === "" || passwordInput === "") {
                alertBox.className = "alert alert-danger text-center";
                alertBox.innerText = "Please enter both email and new password.";
                alertBox.style.display = "block";

                setTimeout(function () {
                    alertBox.style.display = "none";
                }, 3000);

                return; // don't continue
            }

            // SUCCESS: show message then go to Login
            alertBox.className = "alert alert-success text-center";
            alertBox.innerText = "Your password has been reset. Redirecting to login...";
            alertBox.style.display = "block";

            // wait 3s then redirect to Login page
            setTimeout(function () {
                window.location.href = loginUrl;
            }, 3000);
        });
    </script>
}
